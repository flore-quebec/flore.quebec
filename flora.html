<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flore du Québec</title>
  <link rel="stylesheet" href="styles.css">
  <script type="text/javascript" src="data.js"></script>
</head>
<body>
    <div id="header">
        <h1 id="title">Flore du Québec</h1>
        <img id="logo" src="qc.png" alt="Logo">
    </div>
    <div id="filters">
        <div class="dropdown-container">
            <label class="dropdown-label" for="famille">Famille</label>
            <input class="dropdown-input" type="text" id="famille" list="filterList1" onfocus="this.value=''" onchange="this.blur();">
            <datalist id="filterList1"></datalist>
        </div>
        <div class="dropdown-container">
            <label class="dropdown-label" for="genre">Genre</label>
            <input class="dropdown-input" type="text" id="genre" list="filterList2" onfocus="this.value=''" onchange="this.blur();">
            <datalist id="filterList2"></datalist>
        </div>
        <div class="dropdown-container">
            <label class="dropdown-label" for="filter3">Espèce</label>
            <input class="dropdown-input" type="text" id="filter3" list="filterList3" onfocus="this.value=''" onchange="this.blur();">
            <datalist id="filterList3"></datalist>
        </div>
        <div class="dropdown-container">
            <label class="dropdown-label" for="filter4">Nom commun</label>
            <input class="dropdown-input" type="text" id="filter4" list="filterList4">
            <datalist id="filterList4"></datalist>
        </div>
    </div>

    <div class="gallery" id="imageGallery">
        <!-- Example Images -->
        <!-- Add more example images and titles here -->
        <!-- ... -->
    </div>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <!-- <div class="thumbnail-gallery" id="thumbnailGallery">
            <!--<img class="thumbnail-image" src="image1.jpg" alt="Image 1" onclick="openGallery('image1.jpg', 0)"> -->
            <!--<img class="thumbnail-image" src="image2.jpg" alt="Image 2" onclick="openGallery('image2.jpg', 1)"> -->
            <!--<img class="thumbnail-image" src="image3.jpg" alt="Image 3" onclick="openGallery('image3.jpg', 2)"> -->
            <!-- Add more thumbnail images as needed -->
            <!-- </div> -->

            <div class="modal-images" id="modalImages"></div>
            <div class="modal-header" id="modalHeader"></div>
            <div class="container" id="container">
              <div class="taxonomy" id="taxonomy"></div>
              <div class="container" id="links"></div>
            </div>


            <div class="row">
              <div class="column1">
                <div class="modal-text" id="modalText"></div>
                <div class="contributor" id="contributor">Ici on liste les contributeurs pour l'espèce</div>
              </div>
              <div class="column2">
                <div class="info" id="info">Nom scientifique complet<br>Nom scientifique alternatif<br><br>Nom commun<br>Nom commun alternatif<br><br>Statut (e.g. indigène ou introduit)<br><br>Niveau de protection (e.g. vulnérable)</div>
                <img class="map" src="C:/Users/God/Documents/floreqc/qcfloremap.png">
                <img class="pheno" src="C:/Users/God/Documents/floreqc/qcflorepheno.png">
                <div class="contributor" id="data_update">Dernière mise à jour 2023-10-20 à partir de GBIF <a class="doi" href="https://doi.org/10.15468/dl.266m4y" target="_blank">https://doi.org/10.15468/dl.266m4y</a></div>
              </div>
            </div>
        </div>
    </div>




    <!-- The gallery -->
    <div class="gallery2" id="myGallery">
        <span class="close" onclick="closeGallery()">&times;</span>
        <span class="prev" onclick="changeImage(-1)">&#10094;</span>
        <span class="next" onclick="changeImage(1)">&#10095;</span>
        <div class="gallery-content">
            <img class="gallery-image" id="galleryImage">
            <div class="caption" id="caption"></div>
            <div class="link" id="link"></div>
            <!-- <div id=\"link\"></div> -->
        </div>
    </div>


    <script>

        const familleSelect = document.getElementById("famille");
        const genreSelect = document.getElementById("genre");

        const modal = document.getElementById('myModal');
        const modalHeader = document.getElementById('modalHeader');
        const modalText = document.getElementById('modalText');
        const modalImages = document.getElementById('modalImages');
        const gallery = document.getElementById("myGallery");
        //const thumbnailGallery = document.getElementById('thumbnailGallery');

        //const thumbnails = ["image1.jpg", "image2.jpg", "image3.jpg"];

        var thumbnails;
        var which;

        function openModal(headerText, bodyText, imageArray) {
            modal.style.display = 'block';
            modalHeader.textContent = headerText;
            modalText.innerHTML = bodyText;

            // Clear previous images
            modalImages.innerHTML = '';

            // Add images to modal
            imageArray.forEach((imageUrl) => {
                const image = document.createElement('img');
                //const image = document.getElementById('modalImages');
                image.classList.add('modal-image');
                image.src = imageUrl;
                image.onclick = function() {openGallery(imageUrl, 0);};
                modalImages.appendChild(image);
                //<img class="thumbnail-image" src=${imageUrl} alt="Image 1" onclick="openGallery(${imageUrl}, 0)">
            });

            //const links = document.getElementById('links');
            //links.innerHTML='<a target="_blank" href='+data[which].fna+'><img class="fna" src="fna.jpg"></a>';
            const taxonomy = document.getElementById('taxonomy');
            taxonomy.innerHTML=data[which].class+'&nbsp>&nbsp'+data[which].ordre+'&nbsp>&nbsp'+data[which].famille+'&nbsp>&nbsp'+data[which].genre+'&nbsp>&nbsp'+data[which].espèce;
            const right = document.getElementById('links');
            links.innerHTML='<a target="_blank" href='+data[which].vascan+'><img class="fna" src="vascanlogo.jpg"></a><a target="_blank" href='+data[which].inat+'><img class="fna" src="https://static.inaturalist.org/sites/1-favicon.png?1573071870"></a><a target="_blank" href='+data[which].gbif+'><img class="fna" src="https://images.ctfassets.net/uo17ejk9rkwj/5NcJCYj87sT16tJJlmEuWZ/85058d511b3906fbbb199be27b2d1367/GBIF-2015-mark.svg"></a><a target="_blank" href='+data[which].fna+'><img class="fna" src="fna.jpg"></a><a target="_blank" href='+data[which].powo+'><img class="fna" src="https://powo.science.kew.org/img/powo-favicon.ico"></a>';

        }


        function closeModal() {
            modal.style.display = 'none';
        }

                // Function to close the gallery
        function closeGallery() {
            const gallery = document.getElementById("myGallery");
            gallery.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target === modal) {
                closeModal();
            };
            if (event.target === gallery) {
                closeGallery();
            };
        };


        function updatefamilleGallery() {
            const selectedFamille = familleSelect.value;

            const filteredImages = data.filter(image => (
                (selectedFamille === image.famille)
            ));

            // Clear the current gallery
            imageGallery.innerHTML = '';

            // Add filtered images to the gallery
            filteredImages.forEach(image => {
                const imageElement = document.createElement('div');
                imageElement.className = 'image-container';
                imageElement.id = image.alt;
                imageElement.innerHTML = `
                      <img class="image" src=${image.src} alt=${image.alt}>
                      <div class="image-title">
                        ${image.alt}<br>
                        <span class="image-credit">${image.credit[0].replace(", ",", ")}</span>
                      </div>
                `;
                imageGallery.appendChild(imageElement);
            });

            const imageContainers = document.querySelectorAll('.image-container');

            imageContainers.forEach((container, index) => {
                container.addEventListener('click', () => {
                    //const title = container.querySelector('.image-title').textContent;
                    const title = container.id;
                    const text = `
                        <h2>Traits distinctifs</h2>
                        <p>Ici on trouve une description possiblement en liste à points ou en continu des traits distinctifs de l'espèce ou des élémnets clés pour repérer l'espèce sur le terrain. En d'autres mots, que remarque-t-on de particulier chez cette espèce par rapport aux autres semblables</p>
                        <h2>Espèces semblables</h2>
                        <p>Ici on énumère les critères à regarder pour différencier cette espèces des autres espèces semblables. L'idéal est de cibler les espèces qui sont semblables et de ne pas se perdre dans les espèces qui sont clairement différentes si on regarde attentivement les photos.</p>
                        <h2>Habitat</h2>
                        <p>Description sommaire de l'habitat et possiblement de la répartition. On peut se baser sur l'expérience perso.</p>
                        <h2>Commentaires</h2>
                        <p>Est-ce qu'il y a des remarques à faire pour l'espèce notamment en lien avec la distribution, la taxonomie, le statut ou autres trucs intéressants? On peut aussi parler des sous-espèces ou des variétés ou de certaines particularités.</p>
                    `;

                    const index = data.findIndex(p => p.espèce == title); // tests
                    const images = data[index].images;
                    thumbnails = images;
                    which = index;


                    openModal(title, text, images);
                });
            });


        }


        function updategenreGallery() {
            const selectedGenre = genreSelect.value;

            const filteredImages = data.filter(image => (
                (selectedGenre === image.genre)
            ));

            // Clear the current gallery
            imageGallery.innerHTML = '';

            // Add filtered images to the gallery
            filteredImages.forEach(image => {
                const imageElement = document.createElement('div');
                imageElement.className = 'image-container';
                imageElement.innerHTML = `
                      <img class="image" src=${image.src} alt=${image.alt}>
                      <div class="image-title">${image.alt}</div>
                `;
                imageGallery.appendChild(imageElement);
            });

            const imageContainers = document.querySelectorAll('.image-container');

            imageContainers.forEach((container, index) => {
                container.addEventListener('click', () => {
                    const title = container.querySelector('.image-title').textContent;
                    const text = `
                        <h2>Traits distinctifs</h2>
                        <p>Ici on trouve une description possiblement en liste à points ou en continu des traits distinctifs de l'espèce ou des élémnets clés pour repérer l'espèce sur le terrain. En d'autres mots, que remarque-t-on de particulier chez cette espèce par rapport aux autres semblables</p>
                        <h2>Espèces semblables</h2>
                        <p>Ici on énumère les critères à regarder pour différencier cette espèces des autres espèces semblables</p>
                        <h2>Habitat</h2>
                        <p>Description sommaire de l'habitat et possiblement de la répartition</p>
                        <h2>Commentaires</h2>
                        <p>Est-ce qu'il y a des remarques à faire pour l'espèce notamment en lien avec la distribution, la taxonomie, le statut ou autres trucs intéressants</p>
                    `;

                    const index = data.findIndex(p => p.espèce == title); // tests
                    const images = data[index].images;
                    thumbnails = images;
                    which = index;

                    openModal(title, text, images);
                });
            });

        }

        let currentImageIndex = 0;

        // Function to open the gallery with a specific image
        function openGallery(imageSrc, index) {
            const gallery = document.getElementById("myGallery");
            const galleryImage = document.getElementById("galleryImage");
            const captionText = document.getElementById("caption");
            const linkText = document.getElementById("link");
            //const linkText = document.getElementById(\"link\");

            gallery.style.display = "block";
            galleryImage.src = imageSrc;
            currentImageIndex = index;
            captionText.innerHTML = data[which].credit[index];
            //linkText.innerHTML = data[which].link[index];
            link = data[which].link[index];
            linkText.innerHTML = '<a class=\"link\" href=\"' + link + '\" target=\"_blank\">' + link + '</a>' ;
            //captionText.innerHTML = '<a class=\"a3\">' + this.title + '</a>';
            //linkText.innerHTML = '<a class=\"a2\" href=\"' + this.alt + '\" target=\"_blank\">' + this.alt + '</a>' ;
        }


        // Function to switch between images in the gallery
        function changeImage(offset) {
            currentImageIndex = (currentImageIndex + offset + thumbnails.length) % thumbnails.length;
            const galleryImage = document.getElementById("galleryImage");
            const captionText = document.getElementById("caption");
            const linkText = document.getElementById("link");
            galleryImage.src = thumbnails[currentImageIndex];
            captionText.innerHTML = data[which].credit[currentImageIndex];
            //linkText.innerHTML = data[which].link[currentImageIndex];
            link = data[which].link[currentImageIndex];
            linkText.innerHTML = '<a class=\"link\" href=\"'+link+'\" target=\"_blank\">'+link+'</a>' ;
        }


        familleSelect.addEventListener("change", updatefamilleGallery);
        genreSelect.addEventListener("change", updategenreGallery);

        var filter = document.getElementById('filterList1');
        family_values.forEach(function(item){
           var option = document.createElement('option');
           option.value = item;
           filter.appendChild(option);
        });

        var filter = document.getElementById('filterList2');
        genus_values.forEach(function(item){
           var option = document.createElement('option');
           option.value = item;
           filter.appendChild(option);
        });

        var filter = document.getElementById('filterList3');
        species_values.forEach(function(item){
           var option = document.createElement('option');
           option.value = item;
           filter.appendChild(option);
        });



        //updatefamilleGallery(); // not working

    </script>
</body>
</html>
